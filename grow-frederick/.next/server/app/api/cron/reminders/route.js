"use strict";(()=>{var e={};e.id=9050,e.ids=[9050],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},50170:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>P,patchFetch:()=>D,requestAsyncStorage:()=>v,routeModule:()=>y,serverHooks:()=>x,staticGenerationAsyncStorage:()=>E});var n={};t.r(n),t.d(n,{POST:()=>w});var i=t(49303),o=t(88716),s=t(60670),a=t(87070),c=t(20728);let u=null;async function l(){if(null!==u)return u;try{let{Resend:e}=await Function('return import("resend")')();return u=new e(process.env.RESEND_API_KEY)}catch(e){return u=!1,null}}async function d({to:e,subject:r,html:t,text:n}){try{let i=await l();if(!i||!process.env.RESEND_API_KEY)return console.log("Email not sent - RESEND_API_KEY not configured or resend package not installed"),{success:!0,id:"mock-id"};let{data:o,error:s}=await i.emails.send({from:"GrowCommon <noreply@growcommon.com>",to:e,subject:r,html:t,text:n||t.replace(/<[^>]*>/g,"")});if(s)return console.error("Email send error:",s),{success:!1,error:s};return{success:!0,id:o?.id}}catch(e){return console.error("Email service error:",e),{success:!1,error:e}}}async function p(e,r,t,n){let i=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2 style="color: #414535;">Garden Reminder</h2>
      <p>Hello ${r},</p>
      <p>This is a reminder for your garden task:</p>
      <div style="background-color: #f9f0dd; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h3 style="color: #9EBB8C; margin-top: 0;">${t}</h3>
        <p><strong>Date:</strong> ${n}</p>
      </div>
      <p>Happy gardening!</p>
      <p>â€” The GrowCommon Team</p>
    </div>
  `;return d({to:e,subject:`Garden Reminder: ${t}`,html:i})}let m=null;async function h(){if(null!==m)return m;try{let e=await Function('return import("web-push")')();return(m=e.default||e).setVapidDetails(process.env.VAPID_SUBJECT||"mailto:admin@growcommon.com",process.env.VAPID_PUBLIC_KEY||"",process.env.VAPID_PRIVATE_KEY||""),m}catch(e){return m=!1,null}}async function f(e,r){try{let t=await h();if(!t)return console.log("Push notification not sent - web-push package not installed"),{success:!0};let n=JSON.stringify(r);return await t.sendNotification(e,n),{success:!0}}catch(e){return console.error("Push notification error:",e),{success:!1,error:e}}}async function g(e,r,t){return f(e,{title:"Garden Reminder",body:`${r} - ${t}`,icon:"/icons/icon-192x192.png",badge:"/icons/badge-72x72.png",data:{type:"reminder",eventTitle:r,eventDate:t},actions:[{action:"view",title:"View Details"},{action:"dismiss",title:"Dismiss"}]})}async function w(e){try{if(e.headers.get("authorization")!==`Bearer ${process.env.CRON_SECRET}`)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=new Date,t=new Date(r.getTime()+36e5),n=await c._.event.findMany({where:{reminderMinutes:{not:null},start:{gte:r,lte:t},channel:{in:["email","both"]}},include:{user:{select:{id:!0,email:!0,name:!0}}}}),i=[];for(let e of n)try{if(new Date(e.start.getTime()-6e4*e.reminderMinutes)<=r){if("email"===e.channel||"both"===e.channel){let r=await p(e.user.email,e.user.name||"Gardener",e.title,e.start.toLocaleDateString());i.push({eventId:e.id,email:r})}if("push"===e.channel||"both"===e.channel)for(let r of(await c._.pushSubscription.findMany({where:{userId:e.user.id}}))){let t=await g({endpoint:r.endpoint,keys:{p256dh:r.p256dh,auth:r.auth}},e.title,e.start.toLocaleDateString());i.push({eventId:e.id,push:t})}await c._.event.update({where:{id:e.id},data:{reminderMinutes:null}})}}catch(r){console.error(`Error sending reminder for event ${e.id}:`,r),i.push({eventId:e.id,error:r.message})}return a.NextResponse.json({success:!0,processed:n.length,results:i})}catch(e){return console.error("Cron reminders error:",e),a.NextResponse.json({error:"Failed to process reminders"},{status:500})}}let y=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/cron/reminders/route",pathname:"/api/cron/reminders",filename:"route",bundlePath:"app/api/cron/reminders/route"},resolvedPagePath:"C:\\Users\\mathp\\OneDrive\\Desktop\\GrowCommon Cursor\\Grow-Frederick\\grow-frederick\\src\\app\\api\\cron\\reminders\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:v,staticGenerationAsyncStorage:E,serverHooks:x}=y,P="/api/cron/reminders/route";function D(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:E})}},20728:(e,r,t)=>{t.d(r,{_:()=>i});let n=require("@prisma/client"),i=globalThis.prisma??new n.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[9276,5972],()=>t(50170));module.exports=n})();